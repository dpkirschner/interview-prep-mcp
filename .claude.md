# Interview Prep MCP Server

## Overview
This is an MCP (Model Context Protocol) server designed to help with LeetCode practice problem management. The server provides tools to fetch problems from LeetCode with their descriptions, code templates, test cases, and metadata.

## Project Structure
```
interview-prep-mcp/
├── pyproject.toml              # Python project configuration
├── README.md                   # User documentation
├── .gitignore                  # Git ignore rules
├── plans/
│   └── original.md             # Implementation roadmap
├── src/
│   └── interview_prep_mcp/
│       ├── __init__.py
│       ├── server.py           # MCP server entry point
│       ├── leetcode/
│       │   ├── client.py       # LeetCode API client with retry & rate limiting
│       │   ├── types.py        # Pydantic data models
│       │   └── search.py       # Search utilities
│       ├── file_generator/
│       │   └── naming.py       # Filename generation utilities
│       └── tools/
│           └── load_problem.py # MCP tool implementation
├── tests/                      # Comprehensive test suite
│   ├── leetcode/              # Client tests (unit + integration)
│   ├── tools/                 # Tool tests
│   └── file_generator/        # Generator tests
└── venv/                      # Virtual environment (gitignored)
```

## MCP Tools

### `load_problem`
Fetches a LeetCode problem with full metadata.

**Parameters:**
- `title_slug` (str, optional): URL-friendly problem slug (e.g., "two-sum")
- `problem_id` (int, optional): Problem number (e.g., 1)
- `problem_name` (str, optional): Search query (e.g., "binary tree")
- `language` (str, optional): Specific language for code snippet (e.g., "python", "java", "golang")

**Returns:**
- Single problem: Full problem data with description, topics, hints, test cases, and code snippets
- Multiple matches: List of matching problems with basic metadata
- Language-specific: Problem data with code for requested language and suggested filename

**Supported Languages:**
Python, Java, C++, C, C#, JavaScript, TypeScript, Go, Rust, Swift, Kotlin, Ruby, Scala, PHP, Elixir, Racket, SQL

## Key Features

### LeetCode Client (`client.py`)
- **GraphQL API Integration**: Primary method for fetching problems
- **REST API Fallback**: Automatic fallback when GraphQL fails
- **Retry Logic**: 3 attempts with exponential backoff (1s → 2s → 4s)
  - Retries on: `HTTPStatusError`, `TimeoutException`, `ConnectError`, `NetworkError`
  - No retries on: GraphQL errors (ValueError)
- **Rate Limiting**: 10 requests per second using `aiolimiter`
- **Caching**:
  - Problem ID to slug mapping cached on first use
  - Full problem list cached for search functionality
  - Cache persists for server lifetime

### Error Handling
- **Transient Errors**: Automatic retry with exponential backoff
- **Rate Limiting**: Built-in throttling respects LeetCode API
- **Graceful Degradation**: Falls back to REST API if GraphQL fails
- **Clear Error Messages**: Distinguishes between different failure modes

### Search Functionality
- **Fuzzy Matching**: Searches both title and title slug
- **Ranked Results**: Returns up to 10 matches
- **Single Match Auto-Load**: Automatically loads full problem if only one match
- **Cached Search**: Fast in-memory search without API calls

## Dependencies
- `mcp>=0.9.0` - MCP Python SDK
- `httpx>=0.27.0` - Modern async HTTP client
- `pydantic>=2.0.0` - Data validation and serialization
- `beautifulsoup4>=4.12.0` - HTML parsing for problem descriptions
- `python-slugify>=8.0.0` - URL-friendly slug generation
- `tenacity>=9.1.2` - Retry logic with exponential backoff
- `aiolimiter>=1.2.1` - Async rate limiting

## Installation & Setup

### Install in development mode:
```bash
python3 -m venv venv
source venv/bin/activate
pip install -e .
```

### Add to Claude Desktop config:
Edit `~/Library/Application Support/Claude/claude_desktop_config.json`:
```json
{
  "mcpServers": {
    "interview-prep": {
      "command": "/opt/code/interview-prep-mcp/venv/bin/python",
      "args": ["-m", "interview_prep_mcp.server"]
    }
  }
}
```

Or using uv:
```json
{
  "mcpServers": {
    "interview-prep": {
      "command": "uv",
      "args": ["run", "interview-prep-mcp"]
    }
  }
}
```

Then restart Claude Desktop.

## Development

### Running Tests
```bash
# All unit tests
pytest -m "not integration"

# All tests including integration
pytest

# Specific test file
pytest tests/leetcode/test_client.py -xvs

# With coverage
pytest --cov=src/interview_prep_mcp
```

### Code Quality
```bash
# Format
black src tests

# Lint
ruff check src tests

# Type check
mypy src
```

## LeetCode API Details

### GraphQL Endpoint
- URL: `https://leetcode.com/graphql/`
- Headers: `Content-Type: application/json`, `Referer: https://leetcode.com`
- Timeout: 30 seconds
- Query: `questionContent` for fetching problems
- Query: `problemsetQuestionList` for listing all problems (used for caching)

### REST API (Fallback)
- URL: `https://leetcode.com/api/problems/algorithms/`
- Used when GraphQL fails
- Provides problem list for caching

### Rate Limiting
- **Implemented Limit**: 10 requests per second
- **Method**: Token bucket via `aiolimiter.AsyncLimiter`
- **Scope**: Per client instance (singleton in server)
- **Behavior**: Requests beyond limit wait asynchronously

### Retry Strategy
- **Max Attempts**: 3 (initial + 2 retries)
- **Wait Strategy**: Exponential backoff
  - Attempt 1: Immediate
  - Attempt 2: 1-2 seconds
  - Attempt 3: 2-4 seconds
- **Retryable**: Network errors, timeouts, HTTP status errors
- **Non-Retryable**: GraphQL errors, validation errors

## Architecture Notes

### Async Design
- All API calls use `asyncio` and `httpx.AsyncClient`
- Rate limiter is async-aware
- Server handles concurrent requests efficiently

### Type Safety
- Pydantic models for all data structures
- Full mypy type checking (strict mode)
- Type hints throughout codebase

### Testing Strategy
- **Unit Tests**: Mock all external dependencies
- **Integration Tests**: Real API calls (marked separately)
- **Coverage**: 116 tests covering all major functionality
- **Test Organization**: Mirrors source structure
